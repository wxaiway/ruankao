---
id: 'case002'
title: '数据库cache-aside架构设计'
difficulty: 'medium'
chapter: '2024-2'
estimatedTime: 40
points: 25
year: '2024-2'
source: '2024年11月系统架构设计师真题'
tags:
  keywords: ["缓存架构","cache-aside","数据库设计"]
  domains: ["数据库系统","系统架构"]
  difficulty: 'medium'
---

## 试题二：数据库cache-aside架构

阅读下列关于数据库设计的说明，回答问题1至问题3。  
【说明】  
为了提升某购物网站的用户使用体验，采用数据库缓存技术将经常访问的商品信息存储在一个临时高速数据存储层中，这个临时存储层使得未来对这些数据的请求响应比通过访问主数据库更快。为了确保快速、及时获取最新数据，项目组决定采用缓存数据技术开展项目设计，经讨论，决定采用Cache-Aside策略作为缓存手段。

**【问题1】**（10分）  
使用Cache-Aside缓存策略，当用户查询商品信息时，此请求会从应用程序服务器发送请求到数据库服务器，通过缓存系统处理，然后返回所请求的信息，请补充完善图1中（1）~（5）处的内容，协助设计师完成缓存系统中的数据读取模块的设计方案。  
![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952owjMJ4lap/img/360a6c9c-284c-443c-8c0e-69ea350791d7.png)

**【问题2】**（6分）  
使用Cache-Aside缓存策略，当用户更新商品信息时，此请求会从应用服务器发至数据库服务器，并进行缓存处理，请补充完善图2中（1）和（2）处的内容，协助工程师完成缓存系统中的数据更新模块的设计方案。  
![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8oLl952owjMJ4lap/img/1025fb19-549e-446c-a4b9-bd421affc0ef.png)

**【问题3】**（9分）  
李工设计了多线程并发数据访问方案，采用线程1执行数据更新，线程2执行数据读取。王工认为这样的设计方案会存在数据不一致现象，请说明李工所设计的方案为什么会出现数据库与缓存中的数据不一致的情况，并给出3种或以上的解决方案。  

###
<!-- ANSWER_START -->
## 参考答案

**【问题1】**  
（1）向缓存请求读取该商品信息  
（2）若命中则返回该商品信息  
（3）若未命中则访问数据库查询该商品信息  
（4）将查询到的数据库数据更新到缓存  
（5）将查询到的数据库目标数据返回  
**【问题2】**  
（1）更新数据库中的目标商品信息  
（2）删除对应商品的缓存信息  
**【问题3】**

**原因：**

**（1）非原子操作**：【更新DB -> 删除Cache】不是一个原子操作，中间可被其他线程打断。

**（2）执行顺序不确定性**：并发环境下，【读操作】和【写操作】的各个步骤（读DB、读Cache、写DB、写Cache）可以任意交错执行。

**解决方案：**  
（1）异步队列方式同步，可采用消息中间件处理

（2）通过数据库插件完成数据同步

（3）利用触发器进行缓存同步

（4）锁机制

（5）延时双删

（6）设置缓存过期策略

（7）订阅Binlog进行失效

注意：该题的答案并不唯一，能写出三种合理的方案即可，使用Qwen和DeepSeek多学习下。

**解析：**

针对线程1写数据、线程2读缓存时可能出现的数据不一致问题，以下是三种解决方案的详细解析：  
（1）异步队列方式同步，可采用消息中间件处理：此方案利用消息中间件（如Kafka）来确保数据的一致性。当线程1更新数据库后，会发送一个消息到消息队列中。线程2或另一个消费者线程会监听这个队列，并在收到消息后执行相应的缓存更新或删除操作。  
（2）通过数据库插件完成数据同步：一些数据库插件或工具（如MySQL的binlog监听工具）可以监听数据库的更新操作，并在数据发生变化时自动更新缓存。  
（3）利用触发器进行缓存同步：在数据库中设置触发器，当数据表发生INSERT、UPDATE或DELETE操作时，触发器会自动执行相应的缓存更新或删除操作。

（4）锁机制。比如：通过引入读写锁机制，可以确保在数据更新时，没有其他线程可以读取数据。这可以防止线程2在线程1更新数据库时读取到旧数据。在数据更新完成后，再释放读锁，允许其他线程读取数据。

## 详细解析

**

针对线程1写数据、线程2读缓存时可能出现的数据不一致问题，以下是三种解决方案的详细解析：  
（1）异步队列方式同步，可采用消息中间件处理：此方案利用消息中间件（如Kafka）来确保数据的一致性。当线程1更新数据库后，会发送一个消息到消息队列中。线程2或另一个消费者线程会监听这个队列，并在收到消息后执行相应的缓存更新或删除操作。  
（2）通过数据库插件完成数据同步：一些数据库插件或工具（如MySQL的binlog监听工具）可以监听数据库的更新操作，并在数据发生变化时自动更新缓存。  
（3）利用触发器进行缓存同步：在数据库中设置触发器，当数据表发生INSERT、UPDATE或DELETE操作时，触发器会自动执行相应的缓存更新或删除操作。

（4）锁机制。比如：通过引入读写锁机制，可以确保在数据更新时，没有其他线程可以读取数据。这可以防止线程2在线程1更新数据库时读取到旧数据。在数据更新完成后，再释放读锁，允许其他线程读取数据。

## 关键要点

- 理解题目中的核心技术概念
- 掌握相关架构设计原理
- 能够分析实际应用场景

## 评分标准

- 技术理解准确性（40%）
- 分析逻辑清晰性（30%）
- 实践应用合理性（30%）

<!-- ANSWER_END -->
